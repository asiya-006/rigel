<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Ingredient Scanner</title>
    <style>
        * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #FF6B35 0%, #8B2FC9 50%, #1DB9C3 100%);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  position: relative;
  overflow-x: hidden;
}

/* Animated gradient overlay */
body::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    rgba(255, 107, 53, 0.3) 0%,
    rgba(139, 47, 201, 0.3) 50%,
    rgba(29, 185, 195, 0.3) 100%
  );
  animation: gradientShift 15s ease infinite;
  z-index: 0;
}

@keyframes gradientShift {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* Glass container */
.container {
  width: 450px;
  max-width: 95%;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  padding: 35px;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.2);
  position: relative;
  z-index: 1;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

h1 {
  text-align: center;
  color: white;
  margin-bottom: 25px;
  font-size: 2rem;
  text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
}

input,
button {
  width: 100%;
  padding: 14px;
  margin-top: 15px;
  border-radius: 10px;
  font-size: 1rem;
}

/* Input style */
input {
  border: 1px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.2);
  color: white;
  backdrop-filter: blur(10px);
}

input::placeholder {
  color: rgba(255,255,255,0.7);
}

input:focus {
  outline: none;
  border: 1px solid rgba(255,255,255,0.6);
  box-shadow: 0 0 10px rgba(255,255,255,0.3);
}

/* Button style */
button {
  background: rgba(0, 123, 255, 0.9);
  color: white;
  border: none;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
}

button:hover {
  background: rgba(0, 86, 179, 0.9);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 123, 255, 0.6);
}

/* Output box */
#output {
  margin-top: 20px;
  white-space: pre-wrap;
  background: rgba(255, 255, 255, 0.2);
  color: white;
  padding: 15px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.3);
  max-height: 200px;
  overflow-y: auto;
}


    </style>
  </head>
  <body>
    <div class="container">
      <h1>Scan Product Ingredients</h1>

      <input type="file" id="imageInput" accept="image/*" />
      <button id="scanBtn">Scan Ingredients</button>

      <div id="output"></div>

      <button onclick="window.location.href = 'index.html'">
        Back to Home
      </button>
      <button onclick="analyzeWithAI()">Analyze With AI</button>
      
</button>

    </div>

    <!-- Load Tesseract FIRST -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <script>
      const scanBtn = document.getElementById("scanBtn");
      const imageInput = document.getElementById("imageInput");
      const output = document.getElementById("output");

      scanBtn.addEventListener("click", async () => {
        const file = imageInput.files[0];

        if (!file) {
          alert("Please upload an image first.");
          return;
        }

        scanBtn.innerText = "Scanning...";
        scanBtn.disabled = true;

        const {
          data: { text },
        } = await Tesseract.recognize(file, "eng");

        // Clean and format ingredients
        const cleanedText = text
          .replace(/\n/g, " ")
          .replace(/[^a-zA-Z0-9,.\-\s]/g, "")
          .trim();

        output.innerText = "Extracted Text:\n\n" + cleanedText;
        localStorage.setItem("ingredientsData", cleanedText);

        scanBtn.innerText = "Scan Ingredients";
        scanBtn.disabled = false;
      });
      async function analyzeWithAI() {
        const bloodData = JSON.parse(localStorage.getItem("bloodData"));
        const ingredientsData = localStorage.getItem("ingredientsData");

        if (!bloodData || !ingredientsData) {
          alert("Missing blood data or ingredients data.");
          return;
        }

        output.innerText = "Analyzing with AI... Please wait.";

        const response = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=AIzaSyB5LMaw-WzNCezdyw0hgUUFuOy0y0OH5ZA",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              contents: [
                {
                  parts: [
                    {
                      text: `
Blood Report:
Hemoglobin: ${bloodData.hemoglobin}
Sugar: ${bloodData.sugar}
Cholesterol: ${bloodData.cholesterol}
Platelets: ${bloodData.platelets}
BP: ${bloodData.bp}

Product Ingredients:
${ingredientsData}

Based on the blood report, is this product safe?
Explain simply and give health advice.give a short and direct answer
`,
                    },
                  ],
                },
              ],
            }),
          },
        );

        const data = await response.json();

        console.log(data)

        output.innerText =
          "AI Analysis:\n\n" + data.candidates[0].content.parts[0].text;

        // const data = await response.json();

        // output.innerText = "AI Analysis:\n\n" + data.choices[0].message.content;
      }
    </script>
    <!-- <a href="../index.html">Back to Home</a> -->

  </body>
</html>
